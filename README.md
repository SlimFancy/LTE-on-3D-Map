# Simulation Platform Based on Google 3D Map 

## 平台运行依赖
- Windows 7 32bit 或者 64bit
- WampServer 2.5
-	Google Earth浏览器插件
-	平台源代码

## 平台安装

### 安装WampServer 2.5
下载地址：http://www.wampserver.com/en/，下载安装包

选择相应的32位或64位的wampserver2.5.exe安装在电脑中，可以自定义安装路径。如安装过程中提示缺少msvcp.dll或mfc100.dll等动态链接库导致安装失败，请先运行vcredist_x64.exe或vcredist_x86.exe之后再尝试安装（wamp安装中设置默认浏览器设为chrome）。

### 安装Google Earth插件
下载地址：http://www.google.com/intl/zh-CN/earth/explore/products/plugin.html。
为了保证插件能够正常安装，请保证能够与Google Earth正常连接。

### 安装平台源代码
将平台的源代码文件夹拷贝到WampServer的根目录当中。假如WampServer的安装目录是：F:\wamp，那么WampServer的根目录就是：F:\wamp\www。将源代码的文件夹放到这个文件夹当中，至此安装就算完成了。

## 代码结构
- map.php 为仿真平台运行的主程序，加载显示界面的页面信息和一些必要的开源库。
- assets/ 文件夹存放了显示界面所加载网页前端css模板、地图用户图标、js开源库等必要文件。
- assets/js/main.js 文件是演示平台的核心程序，所有的核心功能的代码都在这个文件中。
- data/ 文件夹中存放了UE和基站的信息文件。stations.csv存放了所有基站的经纬度；每个user.csv文件存放了该user每一时刻的经纬度和SINR、Throughput等数值信息。Data文件夹中的文件内容是根据WiSE平台的仿真结果得到的。
- _getdata.ajax.php 异步加载data中的csv文件中的信息，并传输到map.php，在客户端显示。
- getxy.php 是一个小工具，可以在Google Earth上选取某路径上的各个点的经纬度坐标。没有这个文件，平台也可以照常运行。

## 平台使用
### 导入仿真数据
按照平台格式要求，组织UE和基站的数据。在平台中UE和基站的数据信息都是CSV格式的。所有基站的信息放在data/stations.csv文件中。该文件包含两列，分别表示基站的经度和纬度。每一行代表一个基站，有多少个基站就有多少行。
**data/stations.csv的文件格式**
```
latitute,longitude
37.80855260119658, -122.41249244511245
37.808449797752225, -122.41419469933841
37.80820334904404, -122.41581703051999
37.806392479872365, -122.41544137485775
37.80356282526033, -122.41485212412097
37.8037775732111, -122.41327181311013
37.80513133379191, -122.41723067463765
37.8065897190916, -122.41374690996521
37.8056579611102, -122.41359793912936
37.80733711880757, -122.41569949630143
```

所有的UE信息都包含在：data/user1.csv、data/user2.csv、data/user3.csv …里面。有多少个用户，就有多少个文件，文件名中的数字代表了用户的编号。一个典型的用户信息文件格式如下所示。
 
**用户数据文件的格式**
```
latitute,longitude,sinr,throughput
37.80656576,-122.4137918,19.7,4471.9
37.80662734,-122.4138126,19.6,4880.4
37.80668574,-122.413819,18.5,3737
37.80676434,-122.413846,16.4,4001.6
37.80687684,-122.4138663,19.7,3999.1
37.80693407,-122.4138731,18.9,4120.2
37.80704736,-122.4139024,18.2,3658.2
37.80710179,-122.4139097,18.7,4263.6
37.80717512,-122.4139188,17.9,4296
37.80723232,-122.4139207,16.3,3325.2
37.80729004,-122.4139283,19.1,4698.6
37.80735869,-122.4139348,19,3876
37.80739849,-122.4139552,18.7,4506.7
37.80744313,-122.4139627,18.5,4384.5
37.8074675,-122.4140019,20,4180
37.80746476,-122.4140823,15.7,3642.4
37.80745563,-122.4141174,19,3952
                   ......
```

该文件包含四列，分别是经度、纬度、SINR、Throughput。每一行代表每一个时刻上这个用户的信息。目前的时间的精度是秒级别的，也就是说每一行代表一秒的数据。仿真经过了多少秒，这个文件就有多少行。
将这些数据文件准备好后，全部放到data/文件夹下面。另外还需要修改_getdata.ajax.php中的一个变量值。在这个源文件中，变量$un代表了用户的个数，根据实际仿真情况，修改这个变量的值。
 
**$un=6代表有6个用户，使用时要根据情况修改这个值**
```
<?php
$un = 6;

$data = new stdClass;

// get the users' data
for( $i=1; $i<=$un; $i++ ) {
  $filename = "data/user$i.csv";
  $fp = fopen($filename,"r");
  $ud = new stdClass;
  $arr = fgetcsv($fp);
  while( $arr = fgetcsv($fp) ) {
    $ud->lat[] = $arr[0];
    $ud->long[] = $arr[1];
    $ud->sinr[] = $arr[2];
    $ud->throughput[] = $arr[3];
  }
  $data->users[] = $ud;
  fclose($fp);
}
```

##平台功能

经过上面一个步骤，所有演示需要的数据就准备就绪了，接下来就可以运行仿真平台了。
在Chrome或者IE浏览器中键入地址`http://localhost/googlemap/map.php`(地址中的googlemap，表示平台代码放在了googlemap文件夹下面)，回车运行得到客户端显示界面，如下图所示：

![LTE 3D](https://farm4.staticflickr.com/3863/14839628608_ecc33598c4_o.png)
![LTE 3D](https://farm6.staticflickr.com/5576/15025877532_9a000dcf23_o.png)

界面的左侧是3D地图区域，右侧是控制按钮、时间信息以及用户信息。下方是SINR与Throughput的曲线图。

单击右边的“开始”按钮，将启动平台。左侧地图当中的用户（红色手机图标）将会随时间移动位置。单击“暂停”按钮，将会暂停仿真。

单击地图当中用户，用户图标将会从红色变成绿色，表示选中了该用户。


